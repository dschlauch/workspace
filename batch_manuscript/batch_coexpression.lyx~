#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
\usepackage{cite}
\usepackage[T1]{fontenc}
\usepackage{inputenc}
\usepackage{authblk}
\usepackage{lmodern}
\author[1,2]{Daniel Schlauch} 
\author[1]{Joseph Paulson}
\author[2,3]{Kimberly Glass} 
\author[1,3]{John Quackenbush}
\affil[1]{Department of Biostatistics and Computational Biology, Dana-Farber Cancer Institute and Department of Biostatistics, Harvard TH Chan School of Public Health, Boston, MA 02115}
\affil[2]{Channing Division of Network Medicine, Brigham and Women's Hospital, Boston, MA 02115}
\affil[3]{Department of Medicine, Harvard Medical School, Boston, MA 02115}
\affil[4]{Pulmonary and Critical Care Division, Brigham and Women's Hospital and Harvard Medical School, Boston, USA}
\end_preamble
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Batch effect on covariance structure confounds network analyses in gene
 expression studies
\end_layout

\begin_layout Abstract
Systemic biases associated with multiple batches of gene expression experiments
 have been known to confound results in differential gene expression analyses.
 Numerous methods have been developed over the past 10 years which address
 this phenomenon.
 Commonly, these approaches correct expression values such that the mean
 and variance of each gene is conditionally independent of a set of batch
 covariates.
 However, methods published to date have not addressed potential differential
 covariance across batches.
 While this is of lesser concern in the context of standard differential
 gene expression, analyses that utilize a gene co-expression or a correlation
 matrix will continue to see confounding due to batch effect even after
 application of standard batch-correction methods.
 In this article, we demonstrate the persistence of confounding at the covarianc
e level after standard batch correction using simulation studies and real
 world examples.
 Finally, we present an approach for computing a corrected gene expression
 coexpression matrix, called [NAME], based on a maximum likelihood estimation
 of the conditional covariance matrix.
\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Standard
While the accessibility of high-throughput assays has increases, so too
 has the ability to investigate numerous hypotheses simultaneously.
 
\end_layout

\begin_layout Standard

\series bold
[Continue babbling about basic experimental design of gene expression studies...]
\end_layout

\begin_layout Standard
Biological sources of variation are typically of interest, but observed
 variation is often the result of technical artifacts which may confound
 associations between experimental groups and gene expression.
 We can assume the model 
\begin_inset Formula $G_{ij}=\alpha_{j}+X\beta_{j}+B\gamma_{ij}+\delta_{ij}\epsilon_{ij}$
\end_inset

, where 
\begin_inset Formula $G_{ij}$
\end_inset

 is the gene expression of gene 
\begin_inset Formula $j$
\end_inset

 for sample 
\begin_inset Formula $i$
\end_inset

, 
\begin_inset Formula $X$
\end_inset

 is the design matrix, 
\begin_inset Formula $\beta_{j}$
\end_inset

 is a vector of regression coefficients for gene 
\begin_inset Formula $j$
\end_inset

 for the columns of 
\begin_inset Formula $X$
\end_inset

.
 The next two terms specify the additive and multiplicative impacts of batch.
 
\series bold

\begin_inset Formula $B$
\end_inset


\series default
 is an matrix of indicators for each of the batches, and 
\begin_inset Formula $\gamma_{j}$
\end_inset

 is a vector of additive batch effects on gene 
\begin_inset Formula $j$
\end_inset

.
 
\begin_inset Formula $\epsilon_{ij}$
\end_inset

 is the 
\begin_inset Formula $N\left(0,\sigma_{j}^{2}\right)$
\end_inset

 error term and 
\begin_inset Formula $\delta_{ij}$
\end_inset

 is the multiplier of that error term.
 Controlling for batch necessarily involves estimating the impact of batch
 on the mean expression and the variance of that expression, specifically
 
\begin_inset Formula $\gamma_{ij}$
\end_inset

 and 
\begin_inset Formula $\delta_{ij}$
\end_inset

, for each gene.
 Many steps of experimental protocols have been shown to lead to batch effects,
 but it is generally not known what mechanism is at fault for a particular
 study.
 Therefore it is typical to estimate 
\begin_inset Formula $\gamma_{ij}$
\end_inset

 and 
\begin_inset Formula $\delta_{ij}$
\end_inset

 for each gene in a study., 
\series bold
[Continue to describe general batch effect...]
\end_layout

\begin_layout Standard
Despite widespread literature published regarding the identification and
 control of confounding due to batch effect [citations], batch effect correction
 has focused on adjusting for the effects of batch on gene expression mean
 and variance at an individual level.
 For example, ComBat uses an empirical bayes approach to estimate the mean
 and variance parameters for each gene and then computes an adjusted gene
 expression which controls for these effects.
 However, in the context of network inference, we are often interested in
 the covariance of genes as opposed to marginal distribution of each gene.
 Essentially, we assume that genes which are functionally related will exhibit
 a correlated expression pattern across a set of experimental conditions
 or samples.
 
\end_layout

\begin_layout Standard
Standard batch correction approaches fail to remove the impact of a type
 of batch effect which may manifest itself by causing a differential co-expressi
on patterns between two or more genes.
 Removing the impact of differential means and variances across batches
 is critical to removing differential covariance across batch, but will
 be insufficient if the covariance itself is associated with batch.
 While the impact of this oversight may be negligible for differential gene
 expression analysis, co-expression patterns are widely considered in the
 field of network inference.
 The impact of confounding due to differential coexpression in batches remains
 unexamined.
\end_layout

\begin_layout Standard

\series bold
[Describe recent work with sparse covariance estimation...]
\end_layout

\begin_layout Section
Methods
\end_layout

\begin_layout Subsection
Model
\end_layout

\begin_layout Standard
Consider a set of 
\begin_inset Formula $N$
\end_inset

 samples with 
\begin_inset Formula $q$
\end_inset

 covariates measuring gene expression across 
\begin_inset Formula $p$
\end_inset

 genes.
 Let 
\begin_inset Formula $\textbf{x}_{i}=(x_{i1},\dots,x_{iq})$
\end_inset

 denote the confounding covariates for sample 
\begin_inset Formula $i$
\end_inset

 and let 
\begin_inset Formula $\textbf{g}_{i}=(g_{i1},\dots,g_{ip})$
\end_inset

 denote the gene expression values for sample 
\begin_inset Formula $i$
\end_inset

 for the 
\begin_inset Formula $p$
\end_inset

 genes.
\end_layout

\begin_layout Standard
In multivariate regression form we can express this as 
\begin_inset Formula 
\[
\textbf{g}_{i}=\mathbf{\beta}^{T}\textbf{x}_{i}+\mathbf{\epsilon}_{i}\text{ for }i=1,\dots,N
\]

\end_inset

 where 
\begin_inset Formula $\mathbf{\beta}$
\end_inset

 is a 
\begin_inset Formula $q\times p$
\end_inset

 matrix of coefficients.
\end_layout

\begin_layout Standard
Equivalently,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\textbf{G}=\textbf{X}\mathbf{\beta}+\mathbf{E}
\]

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $\textbf{G}$
\end_inset

, 
\begin_inset Formula $\textbf{X}$
\end_inset

, and 
\begin_inset Formula $\textbf{E}$
\end_inset

 are each matrices with row 
\begin_inset Formula $i$
\end_inset

 corresponding to 
\begin_inset Formula $\textbf{g}_{i}$
\end_inset

, 
\begin_inset Formula $\mathbf{x}_{i}$
\end_inset

, and 
\begin_inset Formula $\mathbf{\epsilon}_{i}$
\end_inset

 respectively.
\end_layout

\begin_layout Standard
Here, we make the usual multivariate assumption for 
\begin_inset Formula $\textbf{E}$
\end_inset

 that the rows 
\begin_inset Formula $\mathbf{\epsilon}_{i},\dots,\mathbf{\epsilon}_{N}$
\end_inset

 are independent, and follow distribution, 
\begin_inset Formula $MVN_{p}(\mathbf{0},\Sigma_{i})$
\end_inset

.
 Notably in this paper, the covariance of 
\begin_inset Formula $\mathbf{\epsilon}_{i}$
\end_inset

 differ according to 
\begin_inset Formula $i$
\end_inset

.
\end_layout

\begin_layout Standard
Estimating the covariance structure for a set of 
\begin_inset Formula $p$
\end_inset

 genes typically involves computing the sample covariance matrix, 
\begin_inset Formula $S$
\end_inset

, with entries 
\begin_inset Formula $s_{jk}=\frac{1}{N-1}\sum_{i=1}^{N}(G_{ij}-\bar{G_{\cdot j}})(G_{ik}-\bar{G_{\cdot k}})$
\end_inset

.
 However, as is typical in high-throughput settings, 
\begin_inset Formula $p\gg N$
\end_inset

, producing an estimated covariance matrix 
\begin_inset Formula $p\times p$
\end_inset

 with column rank 
\begin_inset Formula $\le N$
\end_inset

.
\end_layout

\begin_layout Standard
To address this "curse of dimensionality", numerous methods have been proposed.
 One might use a series of LASSO regressions to estimate parameters in the
 inverse covariance matrix [Meinshausen & Buhlmann (2006)], or perform penalized
 maximum likelihood estimation with the penalty on the inverse covariance
 matrix[Yuan & Lin (2007), Friedman (2007), Banerjee (2008)].
 Each of these approaches imposes sparsity on the precision matrix, effectively
 assuming a large degree of condtional independence between genes.
 More recent work has explored imposing sparsity on the covariance matrix
 itself, rather than the precision matrix [Bien & Tibshirani 2011], which
 allows us to assume widespread marginal independence of genes.
 
\end_layout

\begin_layout Subsection
Likelihood function
\end_layout

\begin_layout Standard
The likelihood function is 
\begin_inset Formula 
\[
\mathcal{L}\left(\mu,\Sigma\right)\prod_{i=1}^{N}\frac{1}{\left(2\pi\right)^{\frac{p}{2}}|\Sigma|^{\frac{1}{2}}}e^{-\left(\mathbf{X-\mu}\right)^{T}\Sigma^{-1}-\left(\mathbf{X-\mu}\right)/2}
\]

\end_inset

 
\end_layout

\begin_layout Section*
Results
\end_layout

\begin_layout Standard
Simulated Demonstration
\end_layout

\begin_layout Standard
Consider a set of samples from a study involving two batches.
 Let the expression data be distributed as a set of MVN with mean vector
 
\begin_inset Formula $\mu$
\end_inset

 and covariance structure 
\begin_inset Formula $\Sigma$
\end_inset

.
\end_layout

\begin_layout Standard
Existing batch correction methods are designed to identify differentially
 expressed genes and thus focus on 
\begin_inset Formula $\mu$
\end_inset

 and the diagonal of 
\begin_inset Formula $\Sigma$
\end_inset

.
\end_layout

\begin_layout Standard
For network inference, however, we are less interested in these values and
 more interesting in the off-diagonal of 
\begin_inset Formula $\Sigma$
\end_inset

.
 Mechanisms for batch effect which act on the covariance structure rather
 than the mean and variance structure will not be corrected for using existing
 batch correction methods.
\end_layout

\begin_layout Standard
In figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "simulated_example"

\end_inset

, we see two examples of uncorrected batch effect (Left) impacting two genes
 in a study.
 In the top row, batch effect alters the means and variances of the two
 genes.
 In the bottom row, the means, variances 
\emph on
and
\emph default
 coexpression is impacted.
 Upon application of ComBat (Right) to the uncorrelated genes, the two genes
 become independent as desired.
 However, when applied to the conditionally coexpressed case (Bottom row)
 we continue to observe differential coexpression across batches.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figures/simulated_example.png
	lyxscale 25
	width 100col%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Example of what works and doesn't work for batch effect
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "simulated_example"

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section*
Discussion
\end_layout

\end_body
\end_document
